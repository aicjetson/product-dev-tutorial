# Git，GitHubを使いこなそう

## バージョン管理
Gitは，プロジェクトのバージョン管理システムです．

プロジェクト内のファイルに施した変更の追跡を行ってくれます．

開発中にエラーが発生してしまうことはよくあることですが，開発のどの過程でエラーが発生したのかを探して，エラーが起きる前の状態を復元する必要があります．

こうした時に，開発過程で変更を加えていったそれぞれのバージョンを別々に保存しておきます．

こうしておくことで，後から開発の過程を遡ることができます．

ファイル名に日付をつけたり，番号をふったりしてバージョンを管理する方法もありますが，これは効率的な方法とは言えません．
そこで，こうしたプロセスを自動化してくれるツールが欲しくなります．

そんな時に非常に役立つツールが`Git`と呼ばれるツールです．

`Git`はいつ，誰が，どこを編集したのかという履歴を時系列順に保存します．

後から編集履歴の確認，編集前後の差分の確認，
一度編集したファイルを過去の状態に戻したりすることを簡単に行うことができます．

## リポジトリで履歴を管理しよう
「リポジトリ」とは，ファイルやディレクトリの状態を記録する場所を指します．

リポジトリの管理下に，編集履歴を記録したいプロジェクトのディレクトリを置くことにより，Gitによるこのプロジェクトのバージョン管理が可能になります．

### リモートリポジトリとローカルリポジトリ

Gitには「リモートリポジトリ」，ローカルリポジトリの2つが存在します．

- リモートリポジトリ
専用のサーバにこれを配置することで，複数人でリポジトリの共有が可能です．

- ローカルリポジトリ
手元のPC環境に配置し，個人で操作します．

普段はローカルリポジトリを操作します．そして自分のローカルリポジトリでの作業を共有，公開する時にリモートリポジトリへ作業内容をアップロードします．
このことを「pushする」と言います．
これに対して，他人の編集したものをリモートリポジトリから取得することもできます．これを「pullする」と呼びます．

![](https://i.imgur.com/UFQJFRS.jpg)

### リポジトリの作成
手元の環境に新しくリポジトリを作成する方法には，大きく分けて2つの方法があります．

1. 自分のローカルに全く新しいリポジトリを作成する．
2. リモートリポジトリをコピーして(cloneして)作成する.

新しく作ったローカルリポジトリをリモートリポジトリとしてサーバに追加し，そのリモートリポジトリを他の人にcloneしてもらうことで，同一のリポジトリを他人に共有することができます．

![](https://i.imgur.com/qoSW33b.jpg)

上記の1,2の方法は自分が新しく作る側なのか，それとも他人が新しく作ったものをcloneしてそのプロジェクトの作業を開始するのかの違いになります．

ここまで，他人とプロジェクトを共有することを前提に話していましたが，1人で作業する際も同様の使い方が可能です．

### コミットで変更を記録する
プロジェクト内でファイルを新しく追加したり，ファイルの中身を編集したことを，リポジトリに記録するためには，「コミット」という操作を行います．

コミットを実行すると，リポジトリには，前回コミットによって記録された状態と現在の状態の差分を記録したものがコミットとして作成されます．

このコミットは時系列順に繋がっており，あるコミットには1つ前のコミットを参照するための情報が記録されています．
これにより，最新のコミットからたどっていくと，過去の履歴を順に見ることができる様になっています．
![](https://i.imgur.com/EKL8W0Y.jpg)

## Gitを使ってみよう
Gitを使っていきましょう．
Gitのインストールに関してはOSごとに違いますので，各自調べてみてください．
```
$ git --version
git version 2.17.1
```
としてバージョン情報が表示されたらGitは使用可能な状態です．
それでは，実際に使っていきましょう．

### Gitでのユーザ名，メールアドレス設定
コミットした人が誰なのか等々を記録するためにユーザ名を登録します．

メールアドレスも登録しますが，これは何かにサインアップするためのものではなく，コミットを取った人に連絡を取りたい時などのためであり，署名のようなものです．


```
$ git config --global user.name "Keio Taro"
$ git config --global user.email "***@***"
```

これでこれから作成する全てのプロジェクトで，Gitによる追跡を始めた際に使われるユーザ名，メールアドレスがこちらになりました．（オプションに`--global`を指定しているからです．）

確認してみます．
```
$ git config --global user.name
> [名前]
$ git config --global user.email
> [メールアドレス]
```




### ローカルリポジトリを手元で作成
まずはローカルリポジトリを手元で作成してみましょう．

今回作業する場所を作ります
```
$ mkdir ~/git_tutorial/mysite
$ cd ~/git_tutorial/mysite
$ ls -a
 .       ..
$ git init
$ ls -a
 .       ..      .git
```

これで作成した`mysite`ディレクトリをリポジトリの管理下においてプロジェクトを追跡する準備が整いました．
何も存在しなかったディレクトリの中に`.git`ができたことがわかると思います．

### ファイルを追加し，変更を加える
空っぽのディレクトリにファイルを追加してみます．

```
$ touch hello.txt
```
このtxtファイルに以下の情報を書き込んで保存してください．

```
Hello World!
```
このファイルの追跡を開始したいと思います．この追跡を始めるには2段階の手続きが必要です．

```
$ git add hello.txt
$ git status
>
On branch master

No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)
	new file:   hello.txt
```
git addをステージングと言います．これでcommitする準備ができた状態です．次にcommitします．

```
$ git commit -m "test commit, first commit"
> 
[master (root-commit) 7341d3c] test commit, first commit
 1 file changed, 1 insertion(+)
 create mode 100644 hello.txt
```
commitの際は`-m`オプションでコメントを指定する必要があります．この時，この`commit`をしている変更が「なぜ」行われたのかを書くようにしてください．

プロジェクトを共有する他人，もしくは2週間後の自分が，このメッセージを見て，コミットに記録されたファイルの編集，追加がどうして行われているのかがわかる様にするものです．

### リモートリポジトリを作成する
それでは今作ったローカルリポジトリからサーバ常にリモートリポジトリを作成しましょう．

#### GitHub
GitHubはGitのリポジトリをまとめたサービスです．これを使うことで簡単に他人と共有することができるリモートリポジトリを作成できます．

まずはGitHubにサインアップします．https://github.com/

"sign up"から入って

![](https://i.imgur.com/JTjCtLF.png)

登録を行いましょう．メール認証が来ます．

![](https://i.imgur.com/Tvr1IbU.png)

右上の"+"から"New repository"を選択してください．

![](https://i.imgur.com/mcjMqqA.png)

続いて新しく作成するリモートリポジトリのイニシャライズを行います．
リポジトリの名前を決め，Descriptionにリポジトリの説明を書きましょう．
最後に公開設定としてPrivateにしておきましょう．招待した人しかこのリポジトリを見れなくなります．
全て入力し終わったら下の`Create repojitory`をクリックしてください．

![](https://i.imgur.com/jHcekhj.png)


こういった画面が出れば成功です．

![](https://i.imgur.com/29ksjSY.png)

### 既存のローカルリポジトリを空のリモートリポジトリと連携

先ほど作ったローカルリポジトリを今作った空のリモートリポジトリと連携させます．

mysiteディレクトリに移動したら，
HTTPSのURLをコピーして，
![](https://i.imgur.com/9avJqWQ.png)

以下を実行しましょう．
```
$ git remote add origin {コピーしたURL}
$ git branch -M main
$ git push -u origin main
```
以下のエラーが出た場合は，
```
fatal: unable to access '{URL}': Could not resolve host: github.com
```
以下を実行して，DNSサーバーをGoogleの公開DNSサーバの番号`8.8.8.8`に変更してください．
（以下はLinux系の話です，他のOSに関しても対処は同様ですが，ファイルの場所が違うと思うので注意です．）

```
sudo vim /etc/resolv.conf
```
変更前
![](https://i.imgur.com/X0NibvW.png)
変更後
![](https://i.imgur.com/9pnG4lp.png)

改めて以下を実行します．
```
$ git push -u origin main
```
先ほどgithubで登録したusernameとパスワードで認証します.

![](https://i.imgur.com/40gdcZm.png)

これで完了です．

リモートリポジトリをGithubで覗くと，hello.txtがあるのがわかると思います．


### リモートリポジトリをcloneする．
通常，みんなと共有して使うリポジトリを作りたい時は，先にGitHubでリモートリポジトリを作成し，それをcloneすることでローカルにそのリポジトリをコピーします．cloneでコピーしたプロジェクトはgit initで作ったリポジトリと扱いは同じです．

先ほど作成したリポジトリを別のディレクトリにcloneしてみましょう．
以下の緑色の"Code"のボタンからURLをコピーしてください．

![](https://i.imgur.com/wogN0hH.png)


```
$ mkdir ~/git_tutorial/clone_test
$ cd ~/git_tutorial/clone_test
$ git clone [コピーしたURL]
$ ls
tutorial_jetson
$ cd tutorial_jetson
$ ls
hello.txt
```
先ほど作成した`hello.txt`があることから，リモートリポジトリを取得してローカルリポジトリにできたことがわかると思います．

### 変更をpush，pullする．

今から，`~/git_tutorial/mysite`と`~/git_tutorial/clone_test`のディレクトリを別々の人間が触っていると考えて，自分で一人二役しながらpushとpullを行います．

#### 変更をpushする．
まずは`~/git_tutorial/clone_test/tutorial_jetson`で作業を行います．

```
$ cd ~/git_tutorial/clone_test/tutorial_jetson
```
このディレクトリ内の
`hello.txt`を以下の様に編集して，コミットしてください．

```=
Hello, World!
test push
```
これが完了したら，以下を実行してpushします．

```
$ git push origin main
```
Githubのリモートリポジトリを表示して，反映されていることを確認してみてください．


これは
```
$ git push [リモートリポジトリ名] [pushしたいブランチ名]
```
を表します．"origin"はリモートリポジトリのデフォルト名です．（ブランチは後ほど解説します．）


#### 変更をpullする．

続いて，他人が変更した内容を自分のローカルリポジトリに反映するための方法です．
ディレクトリを移動して，ファイルの中身が古い状態であることを確認します．
```
$ cd ~/git_tutorial/mysite
$ cat hello.txt
Hello, World!
```
以下を実行してpullしましょう．
```
$ git pull origin main
```
ファイルの中身を確認します．

```
$ cat hello.txt
Hello, World!
test push
```
pullの成功が確認できました．



<!-- 先ほどのコマンドは
```
$ git push HEAD
```
でも問題ありません．
`HEAD`は現在のブランチを表します．ブランチつまりコミットの一番新しいものを指しています．上記コマンドは，"現在いるブランチをリモートの同じ名前のリポジトリにpushする"という意味になります． -->.



## ブランチ機能

開発において，1つのプロジェクトを複数人で作業を進めることはよくあることです．
複数のメンバーが同時に機能追加を行ったり、バグ修正を行ったりといったことがあります。

また，複数のリリースバージョンが同時に複数存在することもあります．

このように並行して行われる作業に関するバージョン管理を行うための機能として，「ブランチ」と呼ばれる機能が存在します．

以下の様に，コミットをある地点から分岐させて記録していくことが可能になります．
![](https://i.imgur.com/eQ79I0W.jpg)

### ブランチを使う
先ほど出てきましたが，現在のブランチの名前は，`main`です．
以下の`git branch`コマンドで現在リポジトリに存在するブランチを確認できます．
```
$ cd ~/git_tutorial/mysite
$ git branch
* main
```
それでは，今いるブランチから，新しくブランチを作成してみましょう．ブランチが増えたことを確認しましょう．
```
$ git branch develop main
$ git branch
develop
* master
```
`*`がついているブランチが今いるブランチです．

作ったブランチ`develop`に移動します．
```
$ git checkout develop
Switched to branch 'develop'
```

`develop`ブランチで新しくファイルを作成してcommitを作成しましょう．
```
$ touch hello_dev.txt
```
この変更をコミットしてください．

その後ディレクトリを確認します．
```
$ ls
hello.txt	hello_dev.txt
```
ここまでをリモートリポジトリにpushし，ブランチの作成を反映させます．
```
$ git push origin develop
hello.txt	hello_dev.txt
```
`main`ブランチに戻ります．
```
$ git checkout main
Switched to branch 'main'
$ ls
hello.txt
```
mainブランチにはhello_dev.txtが追加さていません！
これがブランチ機能です．
developでの変更はmainに影響を与えません．

mainでの変更も同様です．以下を行いましょう．
```
$ touch hi_main.txt
$ git add .
$ git commit -m "main checkout test"
```

ここまでをpushしましょう.
```
$ git push origin main
```
## ブランチの仕組み
ブランチは一体どういう仕組みなのでしょうか．

よくある勘違いとして，以下のような機能だと解釈してしまう場合があります．黄色枠で囲った部分を1つのブランチ，青枠で囲った部分を1つのブランチと考えてしまう解釈です．

![](https://i.imgur.com/fG9Xh6Z.jpg)

しかしながら実際にはこうです．
枠で囲ってあるように，「ブランチ」は先頭のコミットだけを指しています．
少し詳しくいうと，Gitにおけるブランチとは、単にコミットを指す軽量なポインタに過ぎません．

![](https://i.imgur.com/A09jK2d.jpg)

先ほど行った「mainブランチからdevelopブランチの作成」を例に考えます．

最初は，この状態です．
`main`が最後のコミットを指し示しています．
![](https://i.imgur.com/JDiICqY.jpg)

次に，
`git branch develop main`を実行したことで，以下の様に`develop`ブランチが作成され，これも`main`ブランチと同じコミットを指し示す様になりました．
![](https://i.imgur.com/b5qbnwY.jpg)

ここで，「`hello_dev.txt`を追加」というコミットが`develop`ブランチにて行われました．developが示すコミットもこの新しいコミットに変わります．

![](https://i.imgur.com/baECyO5.jpg)

最後のmainブランチに切り替えて行ったコミットは，
以下の様になっています．
![](https://i.imgur.com/MZ0lK9o.jpg)


## main(master)ブランチとdevelopブランチ

開発を行うとき，実際にソースコードを編集するブランチと，リリースするための本番ソースコードが書かれたブランチを分けることで，安定して動くバージョンを保持するのが暗黙のルールです．
そのため，main(master)ブランチからdevelopブランチを作成し，開発のコミットはdevelopで行い，新機能の追加や，デバッグなどを行った後，デプロイする状態まで開発するたびにその都度main(master)ブランチにマージすることが推奨されます．

## pull request
複数名で作業するときは，それぞれ実装する機能やデバッグ箇所に応じてブランチを作成して作業します．

そうした作業内容が完了したら，他の人に見てもらって，問題がないか確認してもらって，最後に変更してもらう必要がありますよね．

一連の流れとして

1. 自分が担当する実装用の、branchを作成する
2. 変更点をコミット
3. そのbranchを元にPull Requestを作成する
4. レビュアーはPull Reqeustを確認し、問題なければ元のブランチに反映(マージ)する

この様な流れがあります．変更をコミットした作業ブランチを皆さんに一旦pullしてもらい，レビューしてもらいます．
この要求を「pull request」と呼びます．

### pull　requestを出してみる

Githubに行くと，以下の様にdevelopブランチが反映されていることがわかると思います．
![](https://i.imgur.com/aOHrbmv.png)

developに切り替えると，以下のものが表示されているので．
"Compare and pull request"をクリックし．
![](https://i.imgur.com/wiFTftN.png)

"create pull request"してください．

![](https://i.imgur.com/LsH5etH.png)


## ブランチのマージ
最後に，あるブランチで変更した新たな内容を元のブランチに反映させる方法です．これを「マージ」すると言います．

本流のブランチに切り替え，以下の様に実行します．
以下は実行しないでください！
```
$ git checkout main
$ git merge develop
```
コミットを図で表すと以下の様になります．
2つ新しいコミットができて，それがマージ対象の2つの元々のコミットとの差分を保存し，本流としたブランチの指し示すコミットがそれになっていることがわかります．
`develop`ブランチはこのままです．マージした後もこのままこのブランチでコミットしていくことが可能です．
![](https://i.imgur.com/tyJiOMD.jpg)



さて，先ほどpullrequestを出した箇所を開くと，
以下が表示されるので，merge pull requestを押すと，Github上でマージが実行されます．

![](https://i.imgur.com/RdyvkcD.png)

ここまで終わらせて，各ブランチをローカルにpullすることで，以上の操作がローカルリポジトリにも反映されます．





